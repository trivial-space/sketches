import{f as d,b as vt}from"./painterState.2081fc22.js";import{g as gt}from"./blur.d5b889bc.js";import{p as T}from"./core.b58d4e59.js";import{d as dt,a as pt,e as V,t as ht}from"./quad.93433895.js";import{c as wt}from"./stackgl.1871bf40.js";import{a as St,g as Ft}from"./ast.22bf2736.js";import{j as $,k as n,u as c,o as j,l as C,n as i,x as o,w as G,U as bt,B as l,V as x,S as _,W as p,v as m,L as u,A as f,X as I,Y as Pt,N as h,M as L,D as N,Z as Bt,_ as jt,$ as xt,Q as _t,P as Et,a0 as kt,a1 as Rt,c as O,h as Ut,a2 as yt,m as Dt}from"./vendor.86045b5f.js";const Mt=T(dt,.5,.5),Tt=T(pt,.5,.5);function A(t=1,e){for(let a=0;a<t;a++)e=d(e.map(r=>d(Mt(r).map(Tt))));return e}const Vt=[[0,0],[1,0],[1,1],[0,1]];function H(t,e,a){const r=A(a,[t]),s=d(r);return wt({position:s,normal:s.map(()=>e),uv:d(A(a,[Vt])),cells:ht(r.length)})}function qt(t,e){const a=[0,0,-1],r=V([0,-t*2,0],[[-t,t,0],[t,t,0]]),s=H(r,a,e);return console.log(s,r),s}function $t(t,e){const a=[0,1,0],r=V([0,0,-t*2],[[-t,0,t],[t,0,t]]);return H(r,a,e)}const E=St(),X=Ft();let k,w,S,R,Z,q,W,Y,J;const Ct=X($([R=n("vec3","position"),Z=n("vec3","normal"),q=n("vec2","uv"),W=c("mat4","transform"),Y=c("mat4","projection"),J=c("mat4","view"),k=j("vec3","vNormal"),w=j("vec3","vPos"),S=j("vec2","vUv"),C(()=>[i(k,Z),i(S,q),i(w,R),i(X.gl_Position,o(o(o(Y,J),W),G(R,1)))])]));let K,U,y,v;const Gt=bt("vec4","groundColor",["vec4","float","vec2"],(t,e,a)=>[K=l(x(_(p(m(0),u(1,f(e,90))),m(.8)),_(p(m(0),u(1,f(e,95))),m(.8)),_(p(m(0),u(1,f(e,100))),m(.8)))),U=l(o(I(o(a,40)),.02)),y=l(o(Pt(h(I(o(a,40)),.03)),.04)),v=l(p(L(y),N(y))),Bt(G(o(f(h(o(jt(t),u(u(1,o(v,2)),o(xt(t),.7))),u(x(h(.5,h(L(U),N(U)))),x(v,v,f(v,2)))),1.6),K),1))]);let z,Q,tt,F,et;const It=(t=Gt)=>E($([z=c("sampler2D","reflection"),Q=c("float","reflectionStrength"),tt=c("vec2","size"),k=n("vec3","vNormal"),w=n("vec3","vPos"),S=n("vec2","vUv"),C(()=>[F=l(_t(z,f(Et(E.gl_FragCoord),tt))),i(F,o(F,Q)),et=l(kt(Rt(w,"xz"))),i(E.gl_FragColor,t(F,et,S))])])),g="mirror-scene-ground";function Wt(t,e,a={}){const{width:r,height:s,scale:b=1,renderWithDistanceAlphaUniformName:D="withDistance",groundShaderColorFn:at,blurStrengh:rt=20,blurRatioVertical:ot=2,blurStrenghOffset:st=.3,reflectionStrength:nt=1}=a,ct=t.getForm(g).update($t(100,3)),P=O();Ut(P,P,[b,b,b]);const it=O(),lt=yt(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1),mt=t.getShade(g).update({vert:Ct,frag:It(at)}),ut=gt(t,"blur",{strength:rt,strengthOffset:st,blurRatioVertical:ot}),B=t.getLayer(g).update({sketches:e,effects:ut,uniforms:{view:()=>Dt(it,t.state.viewPort.camera.viewMat,lt),projection:()=>t.state.viewPort.camera.projectionMat,[D]:1},drawSettings:{clearBits:t.gl.DEPTH_BUFFER_BIT|t.gl.COLOR_BUFFER_BIT},width:r,height:s}),ft=t.getSketch(g).update({form:ct,shade:mt,uniforms:{transform:P,reflection:()=>B.image(),size:()=>[r||t.painter.canvas.width,s||t.painter.canvas.height],reflectionStrength:nt}}),M=t.getLayer("scene").update({sketches:[ft].concat(e),uniforms:{view:()=>t.state.viewPort.camera.viewMat,projection:()=>t.state.viewPort.camera.projectionMat,[D]:0},drawSettings:{clearBits:t.gl.DEPTH_BUFFER_BIT|t.gl.COLOR_BUFFER_BIT},width:r,height:s});return r||s||t.listen(g,vt.RESIZE,()=>{M.update(),B.update()}),{scene:M,mirrorScene:B}}export{Wt as c,qt as m};

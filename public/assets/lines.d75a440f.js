var lt=Object.defineProperty,ct=Object.defineProperties;var ft=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var E=(t,e,r)=>e in t?lt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,m=(t,e)=>{for(var r in e||(e={}))G.call(e,r)&&E(t,r,e[r]);if(F)for(var r of F(e))H.call(e,r)&&E(t,r,e[r]);return t},B=(t,e)=>ct(t,ft(e));var K=(t,e)=>{var r={};for(var n in t)G.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&F)for(var n of F(t))e.indexOf(n)<0&&H.call(t,n)&&(r[n]=t[n]);return r};import{g as ut,a as dt}from"./ast.22bf2736.js";import{j as x,k as g,u as h,o as O,l as V,B as u,x as l,A as w,K as R,L as J,y as Y,M as X,D as A,n as S,w as T,z as pt,N as Z,t as $,q as Q,$ as j,v as tt,O as b,P as C,C as gt}from"./vendor.86045b5f.js";import{f as d,t as P}from"./painterState.2081fc22.js";import{t as ht}from"./quad.93433895.js";import{c as mt,a as vt}from"./points.c0fbbf77.js";const k=ut(),et=dt();let U,ot,rt,it,D,I,M,v,_,y;const wt=k(x([U=g("vec2","position1"),rt=g("vec2","position2"),D=g("float","direction"),I=g("vec4","color"),M=h("vec4","uColor"),v=h("vec2","uSize"),_=h("float","uLineWidth"),y=O("vec4","vColor"),V(()=>{let t,e,r;return[r=u(l(w(_,2),D)),t=u(R(J(U,rt))),e=u(Y(A(t),l(-1,X(t)))),S(k.gl_Position,T(l(pt(w(Z(U,l(e,r)),v)),Y(1,-1)),0,1)),S(y,$(Q(j(M),tt(0)),I,M))]})]));let q,z,at;const St=k(x([ot=g("vec3","position1"),it=g("vec3","position2"),I=g("vec4","color"),D=g("float","direction"),M=h("vec4","uColor"),v=h("vec2","uSize"),_=h("float","uLineWidth"),q=h("mat4","uViewMat"),z=h("mat4","uProjectionMat"),at=h("bool","uUseProjection"),y=O("vec4","vColor"),V(()=>{let t,e,r,n,s,c,i,a;return[s=u(l(z,l(q,T(ot,1)))),c=u(l(z,l(q,T(it,1)))),i=u(l(v,w(C(s),b(s)))),a=u(l(v,w(C(c),b(c)))),n=u(l(_,D)),e=u(R(J(C(i),C(a)))),r=u(Y(A(e),l(-1,X(e)))),t=u(gt(z,1)),S(n,$(at,l(A(v),l(A(t),w(l(n,.5),j(s)))),n)),S(k.gl_Position,T(l(w(Z(C(i),l(r,n)),v),b(s)),b(s),j(s))),S(y,$(Q(j(M),tt(0)),I,M))]})])),nt=et(x([y=g("vec4","vColor"),V(()=>[S(et.gl_FragColor,y)])]));function st(n){var s=n,{segments:t,points:e=[]}=s,r=K(s,["segments","points"]);const c={drawType:"TRIANGLES",attribs:{position1:{buffer:new Float32Array(d(t?t.flatMap(([i,a])=>[i,i,a,a]):d(P(i=>{const a=e[i],f=e[i+1];return[a,a,f,f]},e.length-1)))),storeType:r.dynamicForm?"DYNAMIC":"STATIC"},position2:{buffer:new Float32Array(d(t?t.flatMap(([i,a])=>[a,a,i,i]):d(P(i=>{const a=e[i],f=e[i+1];return[f,f,a,a]},e.length-1)))),storeType:r.dynamicForm?"DYNAMIC":"STATIC"},direction:{buffer:new Float32Array(t?t.flatMap(()=>[1,-1,1,-1]):d(P(()=>[1,-1,1,-1],e.length-1))),storeType:r.dynamicForm?"DYNAMIC":"STATIC"}},itemCount:t?t.length*6:e.length&&(e.length-1)*6,elements:{buffer:new Uint32Array(d(ht(t?t.length:e.length-1))),storeType:r.dynamicForm?"DYNAMIC":"STATIC"}};if(r.colors)c.attribs.color={buffer:new Float32Array(d(t?r.colors.flatMap(i=>[i,i,i,i]):d(P(i=>{const a=r.colors[i],f=r.colors[i+1];return[a,a,f,f]},e.length-1)))),storeType:r.dynamicForm?"DYNAMIC":"STATIC"};else{const i=[0,0,0,0];c.attribs.color={buffer:new Float32Array(d(t?t.flatMap(()=>[i,i,i,i]):d(P(a=>[i,i,i,i],e.length-1)))),storeType:r.dynamicForm?"DYNAMIC":"STATIC"}}return c}function Tt(t,e,r){var i,a;const n=t.getSketch(e);let s;r.withPoints&&(s=mt(t,e+"_edge_points",{}));const c=(f={})=>{const o=m(m({points:[]},r),f),W=t.getShade(e).update({frag:o.frag||nt,vert:wt}),L=t.getForm(e).update(st(o));n.update({form:L,shade:W,uniforms:{uLineWidth:(o.lineWidth||1)*t.state.device.sizeMultiplier,uSize:[t.gl.drawingBufferWidth,t.gl.drawingBufferHeight],uColor:o.color||[0,0,0,0]},drawSettings:o.drawSettings}),o.withPoints&&s.update({drawSettings:o.drawSettings&&B(m({},o.drawSettings),{clearBits:void 0,clearColor:void 0}),pointSize:o.lineWidth,positions:o.segments?o.segments.flatMap(([p,N])=>[p,N]):o.points,color:o.color,colors:o.colors&&o.segments?o.colors.flatMap(p=>[p,p]):o.colors,dynamicForm:o.dynamicForm})};return((((i=r.points)==null?void 0:i.length)||0)>=2||((a=r.segments)==null?void 0:a.length))&&c(),{sketch:n,update:c,pointsSketch:s==null?void 0:s.sketch}}function jt(t,e,r){var i,a;const n=t.getSketch(e);let s;r.withPoints&&(s=vt(t,e+"_edge_points",{}));const c=(f={})=>{const o=m(m({points:[]},r),f),W=t.getShade(e).update({frag:o.frag||nt,vert:St}),L=t.getForm(e).update(st(o));n.update({form:L,shade:W,uniforms:{uLineWidth:o.lineWidth||1,uSize:[t.gl.drawingBufferWidth,t.gl.drawingBufferHeight],uColor:o.color||[0,0,0,0],uViewMat:o.viewMat,uProjectionMat:o.projectionMat,uUseProjection:o.scalePerspective||!1},drawSettings:o.drawSettings}),o.withPoints&&s.update({drawSettings:o.drawSettings&&B(m({},o.drawSettings),{clearBits:void 0,clearColor:void 0}),pointSize:o.lineWidth,positions:o.segments?o.segments.flatMap(([p,N])=>[p,N]):o.points,color:o.color,colors:o.colors&&o.segments?o.colors.flatMap(p=>[p,p]):o.colors,dynamicForm:o.dynamicForm,projectionMat:o.projectionMat,scalePerspective:o.scalePerspective,viewMat:o.viewMat})};return((((i=r.points)==null?void 0:i.length)||0)>=2||((a=r.segments)==null?void 0:a.length))&&c(),{sketch:n,update:c,pointsSketch:s==null?void 0:s.sketch}}export{jt as a,Tt as c};

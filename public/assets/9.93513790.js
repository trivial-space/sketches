var E=Object.defineProperty;var v=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var S=(e,o,t)=>o in e?E(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,b=(e,o)=>{for(var t in o||(o={}))L.call(o,t)&&S(e,t,o[t]);if(v)for(var t of v(o))x.call(o,t)&&S(e,t,o[t]);return e};import"./modulepreload-polyfill.b7f2da20.js";import{g as A,b as T,t as M,z as j,d as H}from"./painterState.2081fc22.js";import{m as k}from"./brushStrokes.ff16d99d.js";import{g as C}from"./texture-helpers.e15866c2.js";import{l as F}from"./lines_2d.3b9663ff.js";import{b as N,a as B}from"./brushStrokeLineShader.67fdfe63.js";import{n as R}from"./noise.095b1379.js";import"./pointer.1f73fbf8.js";import"./vectors.212c15dd.js";import"./curves.71ebbb82.js";import"./core.f107e89c.js";import"./core.b58d4e59.js";import"./ast.22bf2736.js";import"./vendor.86045b5f.js";const _=document.getElementById("canvas"),r=A(_),z=b({},T);function I(e,o){return e.flatMap(t=>{const p=R(t.top,t.left,t.width,t.height),g=3*o+5*o*(p+1);if(t.width<=g||t.height<=g)return[t];const i=Math.floor(Math.random()+Math.random()+Math.random()+1);if(t.width/t.height+p/2>=1){const h=t.width/i,d=M(s=>t.left+s*h+Math.max(Math.min((Math.random()-.5)*2*o,h/3),-h/3),i);d[0]=t.left;const a=[];for(const s of[...d].reverse()){const c=a.reduce((f,l)=>f+l,0);a.push(t.width-c-(s-t.left))}return a.reverse(),j((s,c)=>({height:t.height,width:s,left:c,top:t.top,color:[Math.random(),Math.random(),Math.random()]}),a,d)}else{const h=t.height/i,d=M(s=>t.top+s*h+Math.max(Math.min((Math.random()-.5)*2*o,h/3),-h/3),i);d[0]=t.top;const a=[];for(const s of[...d].reverse()){const c=a.reduce((f,l)=>f+l,0);a.push(t.height-c-(s-t.top))}return a.reverse(),j((s,c)=>({height:s,width:t.width,left:t.left,top:c,color:[Math.random(),Math.random(),Math.random()]}),a,d)}})}const n=r.state.device.canvas.height/32,y=r.getShade("line").update({frag:N,vert:B}),P=r.getLayer("noiseTex").update({texture:C({width:256,height:256,startX:3,startY:3,data:{magFilter:"LINEAR",minFilter:"LINEAR",wrap:"REPEAT"}})}),m=r.getLayer("scene").update({drawSettings:{clearBits:0,enable:[r.gl.BLEND],blendFuncSeparate:[r.gl.SRC_ALPHA,r.gl.ONE_MINUS_SRC_ALPHA,r.gl.SRC_ALPHA,r.gl.ONE]}});r.listen("index",z.RESIZE,()=>{m.update({uniforms:{noiseTex:P.image(),size:[r.gl.drawingBufferWidth,r.gl.drawingBufferHeight],texScale:[20,1],edgeSharpness:3},sketches:[r.getEffect("").update({frag:"precision mediump float; void main(void) {gl_FragColor = vec4(1.0);}"})]}),r.painter.compose(m),Y()});let w=[{color:[1,1,1],top:0,left:0,width:r.gl.drawingBufferWidth,height:r.gl.drawingBufferHeight}];H(()=>{w=I(w,n)},7);const D=w.map(e=>O(k({left:e.left-n/3,top:e.top+n/1.5,width:e.width+n/3,height:e.height-n*1.5,offsetX:n*.7,offsetY:n*.4,steps:Math.floor(e.height/(n*1.2)),curveHeight:n,heightFactorFunction:o=>o*1.5-.6}),e.color));function Y(){for(const e of D)e()}function O(e,o){const t=F(e,{lineWidth:n,storeType:"DYNAMIC",smouthCount:3});function p(){const g=t.map((i,u)=>r.getForm("form"+u).update(i)).map((i,u)=>r.getSketch("line"+u).update({form:i,shade:y,uniforms:{color:o}}));m.update({sketches:g}),r.painter.compose(m).show(m)}return p}

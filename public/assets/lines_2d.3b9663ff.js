var q=Object.defineProperty,G=Object.defineProperties;var _=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var j=(t,n,r)=>n in t?q(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,w=(t,n)=>{for(var r in n||(n={}))H.call(n,r)&&j(t,r,n[r]);if(E)for(var r of E(n))J.call(n,r)&&j(t,r,n[r]);return t},A=(t,n)=>G(t,_(n));import{s as K,l as Q,d as X,n as I,a as m,e as T,m as g,b as Z}from"./vectors.212c15dd.js";import{z as y,f as F,d as $}from"./painterState.2081fc22.js";import{l as O}from"./core.f107e89c.js";import{p as R}from"./core.b58d4e59.js";class N{constructor(n,r,l){this.next=null,this.prev=null,this.val=n,this.list=r,this.recalculateNode=l}setNext(n){this.next=n||null}setPrev(n){this.prev=n||null}set(n,r){this.val=n,this.recalculateNode(this,r)}}function z(t,{onNextUpdated:n,onPrevUpdated:r}={}){let l=0,i=null,o=null;function c(e,s){n&&s&&e.prev&&n(e.prev),r&&s&&e.next&&r(e.next)}function f(e,s,u){const a=new N(e,p,c),v=s.next;return s.setNext(a),a.setPrev(s),a.setNext(v),v?v.setPrev(a):o=a,l++,c(a,u),a}function h(e,s){const u=new N(e,p,c);o?(o.setNext(u),u.setPrev(o),o=u,l++):(i=o=u,l=1),c(u,s)}function d(e,s,u){const a=new N(e,p,c),v=s.prev;return s.setPrev(a),a.setNext(s),a.setPrev(v),v?v.setNext(a):i=a,l++,c(a,u),a}function x(e,s){const u=new N(e,p,c);i?(i.setPrev(u),u.setNext(i),i=u,l++):(i=o=u,l=1),c(u,s)}const p={get size(){return l},get first(){return i},get last(){return o},at(e){const s=e<0;let u=Math.abs(e),a=s?o:i,v=a;for(;u>0&&v;)v=s?a&&a.prev:a&&a.next,u--,v&&(a=v);return a},append(e,s){return h(e,s),p},appendAt(e,s,u){return f(s,e,u),p},appendAll(e,s){for(const u of e)h(u,s);return p},prepend(e,s){return x(e,s),p},prependAt(e,s,u){return d(s,e,u),p},prependAll(e,s){for(const u of e)x(u,s);return p},drop(e=1){const s=e<0;let u=Math.min(Math.abs(e),l),a=s?o:i;for(;u>0&&a;)a=s?a.prev:a.next,u--,l--;return l===0?(o=null,i=null):s?(o=a,a==null||a.setNext()):(i=a,a==null||a.setPrev()),p},dropAt(e,s=1){const u=s<0;let a=Math.abs(s),v=e;for(;a>0&&v;)v=u?v.prev:v.next,a--,l--;return l===0?(o=null,i=null):u?(e.next?e.next.setPrev(v):o=v,v?v.setNext(e.next):i=e.next):(e.prev?e.prev.setNext(v):i=v,v?v.setPrev(e.prev):o=e.prev),p},empty(){return l=0,i=null,o=null,p},splitAt(e){const s=z(),u=z();let a=i;for(;a!=e;)s.append(a.val),a=a.next;for(s.append(e.val),a=e;a!=o;)u.append(a.val),a=a.next;return u.append(o.val),[s,u]},[Symbol.iterator]:function*(){let e=i;for(;e;)yield e.val,e=e.next},reverted:{[Symbol.iterator]:function*(){let e=o;for(;e;)yield e.val,e=e.prev}},nodes:{[Symbol.iterator]:function*(){let e=i;for(;e;)yield e,e=e.next}},nodesReverted:{[Symbol.iterator]:function*(){let e=o;for(;e;)yield e,e=e.prev}},nodesFrom(e){return{[Symbol.iterator]:function*(){for(;e;)yield e,e=e.next}}},nodesRevertedFrom(e){return{[Symbol.iterator]:function*(){for(;e;)yield e,e=e.prev}}}};if(t&&t.length)for(const e of t)p.append(e);return p}function C(t,n){return{direction:[0,0],length:0,vertex:t,width:n}}function k(t,n){if(t&&n){const r=K(n.vertex,t.vertex),l=Q(r);t.length=l,t.direction=X(l,r,r)}return t}function M(t,{ratio:n=.25,minLength:r=3,depth:l=1,recalculate:i=!0,interPolate:o=["width"]}={}){if(t&&t.prev&&t.next&&t.prev.val.length>r&&t.val.length>r){const c=t.prev,f=R(O,1-n),h=C(y(f,t.prev.val.vertex,t.val.vertex));for(const p of o){const e=t.prev.val[p],s=t.val[p];typeof s=="number"&&typeof e=="number"&&(h[p]=f(e,s)),Array.isArray(s)&&Array.isArray(e)&&(h[p]=y(f,e,s))}t.list.prependAt(t,h,i),c.set(c.val,i);const d=R(O,n),x=C(y(d,t.val.vertex,t.next.val.vertex));for(const p of o){const e=t.val[p],s=t.next.val[p];typeof e=="number"&&typeof s=="number"&&(x[p]=d(e,s)),Array.isArray(e)&&Array.isArray(s)&&(x[p]=y(d,e,s))}t.set(x,i),t.next.set(t.next.val,i),l>1&&(M(t.prev,{ratio:n,minLength:r,depth:l-1,recalculate:i,interPolate:o}),M(t,{ratio:n,minLength:r,depth:l-1,recalculate:i,interPolate:o}))}}function U(t){return[t[1],-t[0]]}function P(t,n,r){const l=m(g(r,n),t),i=m(g(-r,n),t);return[l,i]}function W(t){return!t.prev||!t.next?!1:T(t.prev.val.direction,t.val.direction)<-.5}function tt(t,n){if(!t.prev&&!t.next)throw"incomplete Line";const r=t.val;if(n=r.width||n||1,!t.prev){const f=U(r.direction);return P(r.vertex,f,n)}if(!t.next){const f=U(t.prev.val.direction);return P(r.vertex,f,n)}const l=U(t.val.direction),i=U(t.prev.val.direction),o=I(m(l,i));let c=n/T(o,i);return c=Math.min(c,n*5),P(t.val.vertex,o,c)}function et(t,n,r,l,i){const o=r.val.width||i||1,c=o/T(I(m(g(-1,l.val.direction),r.val.direction)),r.val.direction),f=Math.sqrt(c*c-o*o);f>.001&&(Z(r.val.direction,l.val.direction)>0?(m(t[0],g(-f,r.val.direction),t[0]),m(t[1],g(f,r.val.direction),t[1]),m(n[0],g(f,l.val.direction),n[0]),m(n[1],g(-f,l.val.direction),n[1])):(m(t[0],g(f,r.val.direction),t[0]),m(t[1],g(-f,r.val.direction),t[1]),m(n[0],g(-f,l.val.direction),n[0]),m(n[1],g(f,l.val.direction),n[1])))}function b(t){return z([],{onNextUpdated:n=>{var r;k(n.val,n.next&&n.next.val),(r=t==null?void 0:t.onNextUpdated)==null||r.call(t,n)},onPrevUpdated:t==null?void 0:t.onPrevUpdated})}function nt(t){let n=0;for(const r of t.nodes)n+=r.val.length;return n}function rt(t){const n=[];let r=b();for(const l of t.nodes)W(l)&&(r.append({vertex:l.val.vertex,width:l.val.width,direction:l.prev.val.direction,length:0}),n.push(r),r=b()),r.append(l.val);return n.push(r),n}function S(t,n=1){$(()=>{for(const r of t.nodes)M(r,{minLength:-1,interPolate:["currentLength","direction","length","uv","localUV","width"]})},n)}function D(t,n){const r=[];let l=0,i=[];r.push(i);for(const o of t){let c=b();for(const f of o)l+=f.length,c.size>1&&l>=n&&(c.append(f),i.push(c),l=0,c=b(),i=[],r.push(i)),c.append(f);c.size>1&&i.push(c)}return r}function ut(t,{lineWidth:n,storeType:r="STATIC",smouthCount:l=0}={}){if(t.size<2)return[{attribs:{},itemCount:0}];const i=Y(t,n);return l&&i.forEach(({bottomLine:o,topLine:c})=>{S(c,l),S(o,l)}),i.map(o=>B(o,r))}function vt(t,{lineWidth:n,storeType:r="STATIC",smouthCount:l=0,splitAfterLength:i}={}){if(t.size<2)return[[{attribs:{},itemCount:0}]];const o=Y(t,n),c=i?lt(o,i):[o];return l&&c.forEach(f=>f.forEach(({bottomLine:h,topLine:d})=>{S(d,l),S(h,l)})),c.map(f=>f.map(h=>B(h,r)))}function B({bottomLine:t,topLine:n},r){const l=[],i=[],o=[],c=[],f=[];let h=n.first,d=t.first;for(;h&&d;)l.push(h.val.vertex,d.val.vertex),i.push(h.val.uv,d.val.uv),o.push(h.val.localUV,d.val.localUV),c.push(h.val.currentLength,d.val.currentLength),f.push(h.val.width,d.val.width),h=h.next,d=d.next;return{attribs:{position:{buffer:new Float32Array(F(l)),storeType:r},uv:{buffer:new Float32Array(F(i)),storeType:r},localUv:{buffer:new Float32Array(F(o)),storeType:r},length:{buffer:new Float32Array(c),storeType:r},width:{buffer:new Float32Array(f),storeType:r}},drawType:"TRIANGLE_STRIP",itemCount:l.length}}function Y(t,n){const r=nt(t),l=rt(t);let i=0,o=!1,c=null,f=null;return l.map(h=>{o=!o;let d=0;const x=[...h];x.pop();let p=x.map(v=>v.length).reduce((v,L)=>v+L,0),e=i/r,s=d/p;const u=b(),a=b();u.append(A(w({},h.first.val),{uv:[.5,e],localUV:[.5,s],currentLength:i,width:0})),a.append(A(w({},h.first.val),{uv:[.5,e],localUV:[.5,s],currentLength:i,width:0}));for(const v of h.nodes){e=i/r,s=d/p;const L=v.val.width||n||1,V=tt(v,n);v===h.first&&c&&f&&et(V,f,v,c,n),u.append(A(w({},v.val),{vertex:V[0],uv:[o?0:1,e],localUV:[o?0:1,s],currentLength:i,width:L})),a.append(A(w({},v.val),{vertex:V[1],uv:[o?1:0,e],localUV:[o?1:0,s],currentLength:i,width:L})),v.next&&(i+=v.val.length,d+=v.val.length),c=v,f=V}return u.append(A(w({},h.last.val),{uv:[.5,e],localUV:[.5,1],currentLength:i,width:0})),a.append(A(w({},h.last.val),{uv:[.5,e],localUV:[.5,1],currentLength:i,width:0})),{bottomLine:a,topLine:u}})}function lt(t,n){const r=[],l=[];for(const f of t)r.push(f.topLine),l.push(f.bottomLine);const i=D(r,n),o=D(l,n),c=[];return i.forEach((f,h)=>{const d=o[h];c.push(y((x,p)=>({bottomLine:p,topLine:x}),f,d))}),c}export{vt as a,b as c,ut as l,C as n,M as s};

var X=Object.defineProperty,Z=Object.defineProperties;var g=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var C=(r,t,n)=>t in r?X(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n,S=(r,t)=>{for(var n in t||(t={}))k.call(t,n)&&C(r,n,t[n]);if(Y)for(var n of Y(t))B.call(t,n)&&C(r,n,t[n]);return r},x=(r,t)=>Z(r,g(t));import{n as T,a as p,m as v,c as N,e as J,s as V}from"./vectors.212c15dd.js";import{w as W,j as d,k as j,l as tt,f as D}from"./painterState.2081fc22.js";import{s as rt}from"./primitives.6d8411f1.js";import{a3 as Q,a4 as P,a5 as F,a6 as z,a7 as nt,a8 as _,a9 as q,aa as H,s as ot,d as at}from"./vendor.86045b5f.js";function K({vertex:r=[0,0,0],normal:t=[0,0,1],direction:n=[0,1,0],length:f=1}={}){return{vertex:r,normal:t,direction:n,length:f}}const E=Q(),G=Q(),I=Q(),$=Q(),ct=P();function pt({length:r,directionAngle:t=0,normalAngle:n=0,tangentAngle:f=0},c=K()){n?F(E,c.normal,n):z(E),t?F(G,c.direction,t):z(G),f?F(I,nt(ct,c.direction,c.normal),f):z(I),_($,_($,G,E),I);const l=q(P(),c.normal,$);H(l,l);const s=q(P(),c.direction,$);H(s,s);const o=P();return ot(o,c.direction,c.length),at(o,o,c.vertex),K({vertex:o,direction:s,normal:l,length:r})}function y(r){return r.direction.length===2?[r.direction[1],-r.direction[0]]:N(r.normal,r.direction)}function M(r=1,t){const n=y(t),f=p(v(r,n),t.vertex),c=p(v(-r,n),t.vertex);return[f,c]}function O(r=1,t){return M(r,x(S({},t),{vertex:p(t.vertex,v(t.length,t.direction))}))}function et(r,t,n){if(J(t.direction,n.direction)<-.8){console.log("adding sharp angle segment!");const c=y(n),l=y(t),s=T(V(c,l)),o=rt([t.vertex,n.vertex],p(n.vertex,n.direction))>=0?-1:1,e=p(n.vertex,v(o*-1*r/2,s));return[x(S({},t),{direction:T(V(e,t.vertex))}),x(S({},n),{vertex:e,direction:v(o,s),length:r}),x(S({},n),{vertex:p(n.vertex,v(o*r/2,s))})]}else return[t,n]}function U(r=1,t,n){r=typeof r=="number"?r:(r(t)+r(n))/2;const f=y(n),c=y(t),l=T(p(f,c));let s=r/J(l,c);s=Math.min(s,r*5);const o=p(v(s,l),n.vertex),e=p(v(-s,l),n.vertex);return[o,e]}function vt(r,t,{withBackFace:n=!1,withNormals:f=!1,withUVs:c=!1,storeType:l}={}){r=[r[0]].concat(W(2,r).flatMap(([u,a])=>{const i=typeof t=="number"?t:(t(u)+t(a))/2;return et(i,u,a).slice(1)}));const s=r.reduce((u,a)=>u+a.length,0);let o=[],e=[],m=[],w=0;for(let u=0;u<r.length;u++){const a=r[u],i=r[u+1],b=typeof t=="number"?t:t(a);if(w+=a.length,u===0&&(o=M(b,a),e=[a.normal,a.normal],m=[[0,0],[1,0]]),i){o=d(o,U(t,a,i));const A=T(p(a.normal,i.normal));e=d(e,j(2,A));const L=w/s;m.push([0,L],[1,L])}else o=d(o,O(b,a)),e=d(e,[a.normal,a.normal]),m.push([0,1],[1,1])}if(n){const u=tt(r);w=0;for(let a=0;a<r.length;a++){const i=u[a],b=u[a+1],A=typeof t=="number"?t:t(i);if(w+=i.length,a===0&&(o=d(o,O(A,i)),e=d(e,j(2,v(-1,i.normal))),m=m.concat([[0,1],[1,1]])),b){o=d(o,U(t,b,i));const L=v(-1,T(p(i.normal,b.normal)));e=d(e,j(2,L));const R=(s-w)/s;m.push([0,R],[1,R])}else o=d(o,M(A,i)),e=d(e,j(2,v(-1,i.normal))),m.push([0,0],[1,0])}}const h={attribs:{position:{buffer:new Float32Array(D(o)),storeType:l}},drawType:"TRIANGLE_STRIP",itemCount:o.length};return f&&(h.attribs.normal={buffer:new Float32Array(D(e)),storeType:l}),c&&(h.attribs.uv={buffer:new Float32Array(D(m)),storeType:l}),h}export{U as a,K as b,vt as c,M as l,pt as w};

var E=Object.defineProperty;var T=(o,t,s)=>t in o?E(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var v=(o,t,s)=>(T(o,typeof t!="symbol"?t+"":t,s),s);import"./modulepreload-polyfill.b7f2da20.js";import{c as g}from"./core.f107e89c.js";import{g as z,t as C,f as A,h as D,i as F,r as O,s as P}from"./painterState.2081fc22.js";import{c as U}from"./lines.d75a440f.js";import{c as q}from"./points.c0fbbf77.js";import{s as M,n as S,l as b,d as G,a as w,m as B}from"./vectors.212c15dd.js";import"./pointer.1f73fbf8.js";import"./ast.22bf2736.js";import"./vendor.86045b5f.js";import"./quad.93433895.js";import"./primitives.6d8411f1.js";import"./core.b58d4e59.js";const K=(o,t,s)=>({h:o,s:t,l:s});function N({h:o,s:t,l:s}){const e=(1-Math.abs(2*s-1))*t,n=e*(1-Math.abs(o*6%2-1)),c=s-e/2;let a,r,p;return o<1/6?(a=e,r=n,p=0):o<2/6?(a=n,r=e,p=0):o<.5?(a=0,r=e,p=n):o<4/6?(a=0,r=n,p=e):o<5/6?(a=n,r=0,p=e):(a=e,r=0,p=n),a=g(0,1,a+c),r=g(0,1,r+c),p=g(0,1,p+c),[a,r,p]}const j=document.getElementById("canvas"),l=z(j);class f{constructor(t){v(this,"value");this.value=t}static of(t){return new f(t)}of(t){return new f(t)}map(t){return new f(t(this.value))}ap(t){return t.flatMap(this.map.bind(this))}flatMap(t){return t(this.value)}combine(t,s){return this.flatMap(e=>s.flatMap(n=>f.of(t(e,n))))}pull(t,s){return this.flatMap(e=>f.of(t(e,s)))}}function I(o,t,s){return o[t]=s(o[t]),o}const d=40,L=6,Q=200,i=C(o=>({id:o,pos:[Math.random()*j.width,Math.random()*j.height],ns:D(L),force:[0,0]}),d),k=A(C(o=>{if(o<d-3){const t=F(o+1,d-1),s=[[o,t]],e=F(o+1,d-1);return e!==t&&s.push([o,e]),s}else return[]},d));function u(o,t,s,e){const n=c=>a=>c.combine(B,t).pull(w,a).value;I(s,"force",n(o)),I(e,"force",n(o.map(c=>-c)))}function W(o){for(const t of k){const s=i[t[0]],e=i[t[1]],n=f.of(e.pos).pull(M,s.pos),c=n.map(S),a=n.map(b).map(r=>r-Q).map(r=>r*2);u(a,c,s,e)}for(let t=0;t<i.length-1;t++){const s=i[t];for(let e=t+1;e<i.length;e++){const n=i[e],c=f.of(n.pos).pull(M,s.pos),a=c.map(S),r=c.map(b),p=r.map(m=>-Math.max(100-m,0));if(u(p,a,s,n),n.ns===s.ns){const m=r.map(h=>h-100);u(m,a,s,n)}else{const m=r.map(h=>-Math.max(200-h,0));u(m,a,s,n)}}}for(const t of i){const s=t.force,e=b(s)-3;if(e>0){const n=G(e+3,s);t.pos=w(t.pos,B(e*(o/500),n)),t.force=[0,0]}}return i}const x=q(l,"points",{pointSize:20,dynamicForm:!0}),y=U(l,"lines",{lineWidth:3,color:[1,1,1,1],dynamicForm:!0,drawSettings:{clearColor:[0,0,0,1],clearBits:l.gl.COLOR_BUFFER_BIT,cullFace:l.gl.BACK,enable:[l.gl.CULL_FACE]}}),H=10;let R=0;O(o=>{R+=o,W(o),x.update({positions:i.map(t=>t.pos),colors:i.map(t=>[...N(K(t.ns/L,1,.5)),1])}),y.update({segments:k.map(([t,s])=>[i[t].pos,i[s].pos])}),l.painter.draw({sketches:[y.sketch,x.sketch]}),R>=H*1e3&&P("render")},"render");
